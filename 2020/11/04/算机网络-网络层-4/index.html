<!DOCTYPE html>
<html lang="zh-CN">
<head>
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fubuk1ng.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="国际控制报文协议ICMPICMP简介ICMP 用于主机或路由器报告差错情况和提供有关异常情况的报告（检测网络错误）。ICMP 不是高层协议，而是 IP 层的协议。">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机网络-网络层-4">
<meta property="og:url" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/index.html">
<meta property="og:site_name" content="fubuking&#39;s blog">
<meta property="og:description" content="国际控制报文协议ICMPICMP简介ICMP 用于主机或路由器报告差错情况和提供有关异常情况的报告（检测网络错误）。ICMP 不是高层协议，而是 IP 层的协议。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/1.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/2.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/3.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/4.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/5.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/6.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/7.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/8.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/9.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/10.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/11.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/12.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/13.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/14.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/15.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/16.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/17.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/18.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/19.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/20.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/21.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/22.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/23.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/24.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/25.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/26.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/27.png">
<meta property="og:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/28.png">
<meta property="article:published_time" content="2020-11-04T12:09:08.000Z">
<meta property="article:modified_time" content="2020-11-06T12:26:01.817Z">
<meta property="article:author" content="fubuking">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/1.png">

<link rel="canonical" href="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>计算机网络-网络层-4 | fubuking's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">

<script src="/live2d-widget/autoload.js"></script>
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">fubuking's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">72</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://fubuk1ng.github.io/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/black.jpg">
      <meta itemprop="name" content="fubuking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fubuking's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          计算机网络-网络层-4
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-04 20:09:08" itemprop="dateCreated datePublished" datetime="2020-11-04T20:09:08+08:00">2020-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-06 20:26:01" itemprop="dateModified" datetime="2020-11-06T20:26:01+08:00">2020-11-06</time>
              </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="国际控制报文协议ICMP"><a href="#国际控制报文协议ICMP" class="headerlink" title="国际控制报文协议ICMP"></a>国际控制报文协议ICMP</h1><h2 id="ICMP简介"><a href="#ICMP简介" class="headerlink" title="ICMP简介"></a>ICMP简介</h2><p>ICMP 用于主机或路由器报告差错情况和提供有关异常情况的报告（检测网络错误）。<br>ICMP 不是高层协议，而是 IP 层的协议。</p>
<a id="more"></a>
<h2 id="ICMP-报文的格式"><a href="#ICMP-报文的格式" class="headerlink" title="ICMP 报文的格式"></a>ICMP 报文的格式</h2><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/1.png" alt="01"></p>
<h2 id="ICMP-报文的类型"><a href="#ICMP-报文的类型" class="headerlink" title="ICMP 报文的类型"></a>ICMP 报文的类型</h2><p>ICMP 报文的前 4 个字节是统一的格式，共有三个字段：即类型、代码和检验和。接着的 4 个字节的内容与 ICMP 的类型有关。</p>
<p>ICMP报文可分为两大类：一、有关信息采集和配置的ICMP报文(称为查询报文（query）或者信息类报文(information message)),二、有关IP数据报传递的ICMP报文（称为差错报文（error message））。</p>
<p>ICMP 差错报告报文有许多种比如 ：</p>
<ul>
<li>终点不可达；比如传输数据过程中，中间某一路由器不知道到目标地址怎么走，该路由器就会发回该报文。</li>
<li>源点抑制(Source quench)； 即反馈发包速度过快；</li>
<li>时间超过 ；</li>
<li>参数问题 ；</li>
<li>改变路由（重定向）(Redirect) ；</li>
</ul>
<p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/2.png" alt="02"></p>
<p>如图三个网段：1,2,3，可以把网段1的网关设置在A处，那么PC0访问PC2时，PC0把数据发送到网关A，经Router0转发到达PC2；如果是PC0访问PC1那么PC0同样也会先把数据发送到网关A，Router再中转到Router1再到PC1，而重定向就是，当PC0发数据给网关A时，Router0给PC0返回一个ICMP差错报告报文，告诉PC0直接发到Router1处更快到达PC1。</p>
<p>报文类型字段（Type）及代码字段（Code）含义对照：略…</p>
<h2 id="ICMP-差错报告报文的数据字段的内容"><a href="#ICMP-差错报告报文的数据字段的内容" class="headerlink" title="ICMP 差错报告报文的数据字段的内容"></a>ICMP 差错报告报文的数据字段的内容</h2><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/3.png" alt="03"><br>如果网络设备1与网络设备2通信，图中A表示网络设备2收到的来自网络设备1的数据报，该数据报并无有用数据，仅起询问是否能通信作用；B表示该设备返回的数据报，图中演示的是A–&gt;B的过程。首先保留A的首部和数据字段中的前8字节，在IP数据报前面添加ICMP的前8字节形成ICMP差错报告报文，再在ICMP差错报告报文前面添加网络层地址形成B数据报；</p>
<h2 id="ping命令诊断网络故障"><a href="#ping命令诊断网络故障" class="headerlink" title="ping命令诊断网络故障"></a>ping命令诊断网络故障</h2><p>PING（Packet Internet Grope），因特网包探索器，用于测试网络连接量的程序。Ping发送一个ICMP回声请求消息给目的地并报告是否收到所希望的ICMP回声应答。</p>
<p>ping指的是端对端连通，通常用来作为可用性的检查，但是某些病毒木马会强行大量远程执行ping命令抢占你的网络资源，导致系统变慢，网速变慢。严禁ping入侵作为大多数防火墙的一个基本功能提供给用户进行选择。</p>
<p>如果你打开IE浏览器访问网站失败，你可以通过ping命令测试到Internet的网络连通，可以为你排除网络故障提供线索，下面展示ping命令返回的信息以及分析其原因。</p>
<p>目标主机不可到达<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/4.png" alt="04"></p>
<p>目标网络不可到达<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/5.png" alt="05"></p>
<p>请求超时<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/6.png" alt="06"><br>说明丢包了。</p>
<p>通过延迟评估网络带宽<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/7.png" alt="07"><br>可以看到最小延迟为54ms，最大延迟57ms，平均延迟55ms。</p>
<p>当 ping 本计算机网关的时候延迟小，速度快：<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/8.png" alt="08"></p>
<p><strong>总结：</strong>ping命令只能检测两端口通或不通。</p>
<h1 id="pathping命令跟踪数据包路径"><a href="#pathping命令跟踪数据包路径" class="headerlink" title="pathping命令跟踪数据包路径"></a>pathping命令跟踪数据包路径</h1><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/9.png" alt="09"><br>当PC0 ping PC1时不通，可能是1~4处某一处或多处断了，也可能是PC1没有开机。而使用PC0 pathping PC1时，从PC0到PC1，每经过一个路由器都会通过该路由器给PC0发回一个数据包说明PC0到该路由器的路径是通的。即Router1给PC0发回一个数据包则表示1、 2通；Router2给PC0发回一个数据包表示1、 2、 3通。在网络排错中具有很强的实用意义。</p>
<p><strong>另一种情况</strong><br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/10.png" alt="10"><br>PC0 pathping PC1时，数据包可以通过Router0，但是Router0设置了进入的数据包无法追踪该路由器，则Router0不会给PC0返回一个数据包。</p>
<p><strong>演示</strong><br>输入命令：<code>pathping www.bilibili.com</code></p>
<p>表示从本计算机访问“<a href="http://www.bilibili.com”该网站的服务器，并追踪途经的各个中转路由器。" target="_blank" rel="noopener">www.bilibili.com”该网站的服务器，并追踪途经的各个中转路由器。</a><br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/11.png" alt="11"></p>
<p>同时pathping命令还会统计通信方到每个中转路由器的丢包率，由此可以看出从哪到哪丢包严重，网络延迟大，据此可以优化网络。</p>
<blockquote>
<p>相同类型的有trace route命令，该命令较为简略不会统计丢包率，这里不做讨论。</p>
</blockquote>
<h1 id="因特网的路由选择协议"><a href="#因特网的路由选择协议" class="headerlink" title="因特网的路由选择协议"></a>因特网的路由选择协议</h1><h2 id="有关路由选择协议的几个基本概念"><a href="#有关路由选择协议的几个基本概念" class="headerlink" title="有关路由选择协议的几个基本概念"></a>有关路由选择协议的几个基本概念</h2><h3 id="关于“最佳路由”"><a href="#关于“最佳路由”" class="headerlink" title="关于“最佳路由”"></a>关于“最佳路由”</h3><p>不存在一种绝对的最佳路由算法。<br>所谓“最佳”只能是相对于某一种特定要求下得出的较为合理的选择而已。<br>实际的路由选择算法，应尽可能接近于理想的算法。<br>路由选择是个非常复杂的问题     </p>
<ul>
<li>它是网络中的所有结点共同协调工作的结果。</li>
<li>路由选择的环境往往是不断变化的，而这种变化有时无法事先知道。<h3 id="从路由算法的自适应性考虑"><a href="#从路由算法的自适应性考虑" class="headerlink" title="从路由算法的自适应性考虑"></a>从路由算法的自适应性考虑</h3>静态路由选择策略——即非自适应路由选择，需要手动添加路由表，其特点是简单和开销较小，但不能及时适应网络状态的变化。</li>
</ul>
<p>动态路由选择策略——即自适应路由选择，不需要手动添加路由表，其特点是能较好地适应网络状态的变化，但实现起来较为复杂，开销也比较大。</p>
<blockquote>
<p>一般比较大型的网络，靠人力无法维护使用动态路由协议，比较小的局域网使用静态路由协议</p>
</blockquote>
<h3 id="分层次的路由选择协议"><a href="#分层次的路由选择协议" class="headerlink" title="分层次的路由选择协议"></a>分层次的路由选择协议</h3><p>因特网采用分层次的路由选择协议。</p>
<p>因特网的规模非常大。如果让所有的路由器知道所有的网络应怎样到达，则这种路由表将非常大，处理起来也太花时间。而所有这些路由器之间交换路由信息所需的带宽就会使因特网的通信链路饱和。</p>
<h3 id="自治系统-AS-Autonomous-System"><a href="#自治系统-AS-Autonomous-System" class="headerlink" title="自治系统 AS(Autonomous System)"></a>自治系统 AS(Autonomous System)</h3><p>自治系统 AS 的定义：在单一的技术管理下的一组路由器，而这些路由器使用一种 AS 内部的路由选择协议和共同的度量以确定分组在该 AS 内的路由，同时还使用一种 AS 之间的路由选择协议用以确定分组在 AS之间的路由。</p>
<p>现在对自治系统 AS 的定义是强调下面的事实：尽管一个 AS 使用了多种内部路由选择协议和度量，但重要的是一个 AS 对其他 AS 表现出的是一个单一的和一致的路由选择策略。</p>
<h3 id="因特网有两大类路由选择协议"><a href="#因特网有两大类路由选择协议" class="headerlink" title="因特网有两大类路由选择协议"></a>因特网有两大类路由选择协议</h3><p>内部网关协议 IGP (Interior Gateway Protocol) 即在一个自治系统内部使用的路由选择协议。目前这类路由选择协议使用得最多，如 RIP 和 OSPF 协议。</p>
<p>外部网关协议EGP (External Gateway Protocol) 若源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。这样的协议就是外部网关协议 EGP。在外部网关协议中目前使用最多的是 BGP-4。</p>
<p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/12.png" alt="12"></p>
<p>自治系统之间的路由选择也叫做：域间路由选择(interdomain routing)；<br>在自治系统内部的路由选择叫做：域内路由选择(intradomain routing) 。</p>
<h2 id="内部网关协议-RIP-Routing-Information-Protocol"><a href="#内部网关协议-RIP-Routing-Information-Protocol" class="headerlink" title="内部网关协议 RIP(Routing Information Protocol)"></a>内部网关协议 RIP(Routing Information Protocol)</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>路由信息协议 RIP 是内部网关协议属于动态路由协议， 内部网关协议（IGP）中最早得到广泛使用的协议（开放非标准协议）。<br>RIP 是一种分布式的基于距离向量的路由选择协议。<br>仅和相邻路由器交换信息。<br>交换的信息是当前本路由器所知道的全部信息，即自己的路由表。<br>按固定的时间间隔交换路由信息（周期性广播），例如，每隔 30 秒。<br>RIP 协议要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录。    </p>
<h3 id="“距离”的定义"><a href="#“距离”的定义" class="headerlink" title="“距离”的定义"></a>“距离”的定义</h3><p>从一路由器到直接连接的网络的距离定义为 1。<br>从一个路由器到非直接连接的网络的距离定义为所经过的路由器数加 1。<br>RIP 协议中的“距离”也称为“跳数”(hop count)，因为每经过一个路由器，跳数就加 1。<br>这里的“距离”实际上指的是“最短距离”。<br>RIP 认为一个好的路由就是它通过的路由器的数目少，即“距离短”。<br>RIP 允许一条路径最多只能包含 15 个路由器。<br>“距离”的最大值为16 时即相当于不可达。可见 RIP 只适用于小型互联网。<br>RIP 不能在两个网络之间同时使用多条路由。RIP 选择一个具有最少路由器的路由（即最短路由），哪怕还存在另一条高速(低时延)但路由器较多的路由。    </p>
<h3 id="简化过程举例"><a href="#简化过程举例" class="headerlink" title="简化过程举例"></a>简化过程举例</h3><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/13.png" alt="13"><br><strong>网段2的PC1与网段1的PC0通信。</strong></p>
<p>数据包传输到路由器A处，下一跳可以是D，A就告诉D我连着1网段，然后D就记住了到1网段下一跳给A就行，并且经过1个路由器；</p>
<p>再下一跳是E，D就告诉E我连着1网段，然后E记住了到1网段下一跳给D就行，并且经过2个路由器。</p>
<p>再下一跳是F，E就告诉F我连着1网段，然后F记住了到1网段下一跳给E就行，并且经过3个路由器。</p>
<p>再下一跳是C，F就告诉C我连着1网段，然后C记住了到1网段下一跳给F就行，并且经过4个路由器。最后数据包到达PC1。</p>
<p>在A处下一跳也可以是B，以此类推只经过了2个路由器。目前为止C学到了从2网段到1网段有两条路径，分别需要经过2个或4个路由器，最后A保留C-&gt;B-&gt;A这条最佳路径。</p>
<p>假如3处断了，B就不能周期性地告诉C到网段1怎么走了，于是经过4个路由器的路线C-&gt;F-&gt;E-&gt;D-&gt;A成为可用的主路径；当3处重新连接，C就会重新使用C-&gt;B-&gt;A这一路径。这就是动态路由协议的好处，不用手动添加路由表，路由器会自动根据网络变化动态选择最佳路径（由）。</p>
<h3 id="为什么需要周期性广播？"><a href="#为什么需要周期性广播？" class="headerlink" title="为什么需要周期性广播？"></a>为什么需要周期性广播？</h3><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/14.png" alt="14"><br>如图：如果仅广播一次，A告诉B到网段1给我就行，之后A宕机了，B却不知道仍然把从C来的到网段1的数据包传给A，造成错误；如果周期性广播B每30s呼叫一次A，多次呼叫A都无回复，B就认为A去世了并告诉C以后到网段1别走这条路了。</p>
<p>周期性广播交换路由信息确保了能够根据设备故障造成的网络变化来动态更新最佳路由。</p>
<h2 id="内部网关协议OSPF-Open-Shortest-Path-First"><a href="#内部网关协议OSPF-Open-Shortest-Path-First" class="headerlink" title="内部网关协议OSPF (Open Shortest Path First)"></a>内部网关协议OSPF (Open Shortest Path First)</h2><h3 id="OSPF-协议的基本特点"><a href="#OSPF-协议的基本特点" class="headerlink" title="OSPF 协议的基本特点"></a>OSPF 协议的基本特点</h3><p>“开放”表明 OSPF 协议不是受某一家厂商控制，而是公开发表的。 </p>
<p>“最短路径优先”是因为使用了 Dijkstra 提出的最短路径算法SPF</p>
<p>OSPF 只是一个协议的名字，它并不表示其他的路由选择协议不是“最短路径优先”。是分布式的链路状态协议。</p>
<h3 id="三个要点"><a href="#三个要点" class="headerlink" title="三个要点"></a>三个要点</h3><p>向本自治系统中所有路由器发送信息，这里使用的方法是洪泛法。</p>
<p>发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。</p>
<p>“链路状态”就是说明本路由器都和哪些路由器相邻，以及该链路的“度量”(metric)。</p>
<p>只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息。</p>
<h3 id="链路状态数据库-link-state-database"><a href="#链路状态数据库-link-state-database" class="headerlink" title="链路状态数据库(link-state database)"></a>链路状态数据库(link-state database)</h3><p>由于各路由器之间频繁地交换链路状态信息，因此所有的路由器最终都能建立一个链路状态数据库。</p>
<p>这个数据库实际上就是全网的拓扑结构图，它在全网范围内是一致的（这称为链路状态数据库的同步）。</p>
<p>OSPF 的链路状态数据库能较快地进行更新，使各个路由器能及时更新其路由表。OSPF 的更新过程收敛得快是其重要优点。</p>
<h3 id="OSPF-的区域-area"><a href="#OSPF-的区域-area" class="headerlink" title="OSPF 的区域(area)"></a>OSPF 的区域(area)</h3><p>为了使 OSPF 能够用于规模很大的网络，OSPF 将一个自治系统再划分为若干个更小的范围，叫作区域。</p>
<p>每一个区域都有一个 32 位的区域标识符（用点分十进制表示）。</p>
<p>区域也不能太大，在一个区域内的路由器最好不超过 200 个。</p>
<p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/15.png" alt="15"></p>
<p>划分区域的好处就是将利用洪泛法交换链路状态信息的范围局限于每一个区域而不是整个的自治系统，一个区域内的链路状态发生变化不影响其他区域，这就减少了整个网络上的通信量。</p>
<p>在一个区域内部的路由器只知道本区域的完整网络拓扑，而不知道其他区域的网络拓扑的情况。</p>
<p>OSPF 使用层次结构的区域划分。在上层的区域叫作主干区域(backbone area)。主干区域的标识符规定为0.0.0.0。主干区域的作用是用来连通其他在下层的区域。</p>
<h3 id="OSPF-的特点"><a href="#OSPF-的特点" class="headerlink" title="OSPF 的特点"></a>OSPF 的特点</h3><p>OSPF 不用 UDP 而是直接用 IP 数据报传送。</p>
<p>OSPF 对不同的链路可根据 IP 分组的不同服务类型 TOS 而设置成不同的代价。因此，OSPF 对于不同类型的业务可计算出不同的路由。</p>
<p>如果到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径。这叫作多路径间的负载平衡。</p>
<p>所有在 OSPF 路由器之间交换的分组都具有鉴别的功能。</p>
<p>支持可变长度的子网划分和无分类编址 CIDR。</p>
<p>每一个链路状态都带上一个 32 位的序号，序号越大状态就越新。</p>
<h3 id="OSPF的基本操作流程"><a href="#OSPF的基本操作流程" class="headerlink" title="OSPF的基本操作流程"></a>OSPF的基本操作流程</h3><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/16.png" alt="16"></p>
<h3 id="OSPF-分组"><a href="#OSPF-分组" class="headerlink" title="OSPF 分组"></a>OSPF 分组</h3><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/17.png" alt="17"></p>
<p>类型1，问候(Hello)分组。<br>类型2，数据库描述(Database Description)分组。<br>类型3，链路状态请求(Link State Request)分组。<br>类型4，链路状态更新(Link State Update)分组，用洪泛法对全网更新链路状态。<br>类型5，链路状态确认(Link State Acknowledgment)分组。    </p>
<h3 id="OSPF-的其他特点"><a href="#OSPF-的其他特点" class="headerlink" title="OSPF 的其他特点"></a>OSPF 的其他特点</h3><p>OSPF 还规定每隔一段时间，如 30 分钟，要刷新一次数据库中的链路状态。</p>
<p>由于一个路由器的链路状态只涉及到与相邻路由器的连通状态，因而与整个互联网的规模并无直接关系。因此当互联网规模很大时，OSPF 协议要比距离向量协议 RIP 好得多。</p>
<p>OSPF 没有“坏消息传播得慢”的问题，据统计，其响应网络变化的时间小于 100 ms。</p>
<h3 id="指定的路由器-designated-router"><a href="#指定的路由器-designated-router" class="headerlink" title="指定的路由器(designated router)"></a>指定的路由器(designated router)</h3><p>多点接入的局域网采用了指定的路由器的方法，使广播的信息量大大减少。</p>
<p>指定的路由器代表该局域网上所有的链路向连接到该网络上的各路由器发送状态信息。</p>
<h3 id="与RIP协议的区别"><a href="#与RIP协议的区别" class="headerlink" title="与RIP协议的区别"></a>与RIP协议的区别</h3><p>相同点：都是开放式的动态路由协议；</p>
<p>度量值为带宽，支持多区域，触发式更新（不以固定时间广播式更新）</p>
<p>三个表：邻居表（Hello），链路状态表，计算路由表。</p>
<h2 id="外部网关协议-BGP"><a href="#外部网关协议-BGP" class="headerlink" title="外部网关协议 BGP"></a>外部网关协议 BGP</h2><p>BGP 较新BGP 是不同自治系统的路由器之间交换路由信息的协议。</p>
<p>边界网关协议 BGP 只能是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子），而并非要寻找一条最佳路由。</p>
<p>每一个自治系统的管理员要选择至少一个路由器作为该自治系统的“ BGP 发言人” 。</p>
<h3 id="BGP-发言人和自治系统-AS-的关系"><a href="#BGP-发言人和自治系统-AS-的关系" class="headerlink" title="BGP 发言人和自治系统 AS 的关系"></a>BGP 发言人和自治系统 AS 的关系</h3><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/18.png" alt="18"></p>
<p>BGP 发言人往往就是 BGP 边界路由器，但也可以不是 BGP 边界路由器。</p>
<p>一个 BGP 发言人与其他自治系统中的 BGP 发言人要交换路由信息，就要先建立 TCP 连接，然后在此连接上交换 BGP 报文以建立 BGP 会话(session)，利用 BGP 会话交换路由信息。</p>
<p>使用 TCP 连接能提供可靠的服务，也简化了路由选择协议。</p>
<p>使用 TCP 连接交换路由信息的两个 BGP 发言人，彼此成为对方的邻站或对等站。</p>
<p>不同的自治系统使用的可以是不同的动态/静态协议，可以是RIP也可以是OSPF 。</p>
<h3 id="AS-的连通图举例"><a href="#AS-的连通图举例" class="headerlink" title="AS 的连通图举例"></a>AS 的连通图举例</h3><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/19.png" alt="19"></p>
<p>BGP 所交换的网络可达性的信息就是要到达某个网络所要经过的一系列 AS。</p>
<p>当 BGP 发言人互相交换了网络可达性的信息后，各 BGP 发言人就根据所采用的策略从收到的路由信息中找出到达各 AS 的较好路由。</p>
<h3 id="BGP-发言人交换路径向量"><a href="#BGP-发言人交换路径向量" class="headerlink" title="BGP 发言人交换路径向量"></a>BGP 发言人交换路径向量</h3><p>图中主干网AS1连接两个自治系统AS2和AS3，它们分别连接两个区域。<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/20.png" alt="20"></p>
<p>自治系统 AS2 的 BGP 发言人通知主干网的 BGP 发言人：“要到达网络 N1, N2, N3 和 N4 可经过 AS2。”</p>
<p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/21.png" alt="21"><br>主干网在收到AS2的通知以后就发出通知：“要到达网络N1，N2，N3，N4可沿路径AS1，AS2”。</p>
<p>同理，主干网还可以发出通知：“要到达网络 N5, N6 和 N7 可沿路径（AS1, AS3）。”</p>
<h3 id="BGP-协议的特点"><a href="#BGP-协议的特点" class="headerlink" title="BGP 协议的特点"></a>BGP 协议的特点</h3><p>BGP协议支持CIDR。</p>
<p>BGP建立时，交换整个路由表但之后只交换变化部分。</p>
<p>BGP 协议交换路由信息的结点数量级是自治系统的数量级，这要比这些自治系统中的网络数少很多。</p>
<p>每一个自治系统中 BGP 发言人（或边界路由器）的数目是很少的。这样就使得自治系统之间的路由选择不致过分复杂。</p>
<h3 id="BGP-4-共使用四种报文"><a href="#BGP-4-共使用四种报文" class="headerlink" title="BGP-4 共使用四种报文"></a>BGP-4 共使用四种报文</h3><p>打开(OPEN)报文，用来与相邻的另一个BGP发言人建立关系。<br>更新(UPDATE)报文，用来发送某一路由的信息，以及列出要撤消的多条路由。<br>保活(KEEPALIVE)报文，用来确认打开报文和周期性地证实邻站关系。<br>通知(NOTIFICATION)报文，用来发送检测到的差错。    </p>
<h3 id="BGP-报文具有通用的首部"><a href="#BGP-报文具有通用的首部" class="headerlink" title="BGP 报文具有通用的首部"></a>BGP 报文具有通用的首部</h3><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/22.png" alt="22"></p>
<h2 id="路由器在网际互连中的作用"><a href="#路由器在网际互连中的作用" class="headerlink" title="路由器在网际互连中的作用"></a>路由器在网际互连中的作用</h2><h3 id="路由器的结构"><a href="#路由器的结构" class="headerlink" title="路由器的结构"></a>路由器的结构</h3><p>路由器是一种具有多个输入端口和多个输出端口的专用计算机，其任务是转发分组。也就是说，将路由器某个输入端口收到的分组，按照分组要去的目的地（即目的网络），把该分组从路由器的某个合适的输出端口转发给下一跳路由器。</p>
<p>下一跳路由器也按照这种方法处理分组，直到该分组到达终点为止。</p>
<h3 id="典型的路由器的结构"><a href="#典型的路由器的结构" class="headerlink" title="典型的路由器的结构"></a>典型的路由器的结构</h3><p><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/23.png" alt="23"></p>
<p>上图中的序号1，2，3分别表示物理层，数据链路层和网络层。可以看到路由器是在数据传输的网络层对数据报进行分组转发的。</p>
<h3 id="路由器中的交换结构分类"><a href="#路由器中的交换结构分类" class="headerlink" title="路由器中的交换结构分类"></a>路由器中的交换结构分类</h3><p>通过存储器：<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/24.png" alt="24"></p>
<p>通过总线：<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/25.png" alt="25"></p>
<p>通过互连网络：<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/26.png" alt="26"></p>
<h3 id="“转发”和“路由选择”的区别"><a href="#“转发”和“路由选择”的区别" class="headerlink" title="“转发”和“路由选择”的区别"></a>“转发”和“路由选择”的区别</h3><p>“转发”(forwarding)就是路由器根据转发表将用户的 IP 数据报从合适的端口转发出去。</p>
<p>“路由选择”(routing)则是按照分布式算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由。</p>
<p>路由表是根据路由选择算法得出的。而转发表是从路由表得出的。在讨论路由选择的原理时，往往不去区分转发表和路由表的区别。</p>
<h3 id="路由器输入和输出端口对收到分组的处理"><a href="#路由器输入和输出端口对收到分组的处理" class="headerlink" title="路由器输入和输出端口对收到分组的处理"></a>路由器输入和输出端口对收到分组的处理</h3><p>输入端口：<br>数据链路层剥去帧首部和尾部后，将分组送到网络层的队列中排队等待处理。这会产生一定的时延，称为处理时延。<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/27.png" alt="27"></p>
<p>输出端口：将交换结构传送来的分组发送到线路。<br>交换结构传送过来的分组先进行缓存（排队）。数据链路层处理模块给分组加上数据链路层的首部和尾部，随后交给物理层，物理层处理完后发送到外部线路 。<br><img src="/2020/11/04/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-4/28.png" alt="28"></p>
<h3 id="分组丢弃"><a href="#分组丢弃" class="headerlink" title="分组丢弃"></a>分组丢弃</h3><p>若路由器处理分组的速率赶不上分组进入队列的速率，则队列的存储空间最终必定减少到零，这就使后面再进入队列的分组由于没有存储空间而只能被丢弃。</p>
<p>由于路由器需要处理过多数据，导致输入或输出队列产生溢出是造成分组丢失的重要原因。</p>

    </div>

    
    
    

<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束-------------</div>
    
</div>

  
</div>

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/03/%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-3/" rel="prev" title="计算机网络-网络层-3">
      <i class="fa fa-chevron-left"></i> 计算机网络-网络层-3
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/11/07/%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82-5/" rel="next" title="计算机网络-网络层-5">
      计算机网络-网络层-5 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>	
  
<aside class="sidebar">
    <div class="sidebar-inner">
	
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#国际控制报文协议ICMP"><span class="nav-number">1.</span> <span class="nav-text">国际控制报文协议ICMP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ICMP简介"><span class="nav-number">1.1.</span> <span class="nav-text">ICMP简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ICMP-报文的格式"><span class="nav-number">1.2.</span> <span class="nav-text">ICMP 报文的格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ICMP-报文的类型"><span class="nav-number">1.3.</span> <span class="nav-text">ICMP 报文的类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ICMP-差错报告报文的数据字段的内容"><span class="nav-number">1.4.</span> <span class="nav-text">ICMP 差错报告报文的数据字段的内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ping命令诊断网络故障"><span class="nav-number">1.5.</span> <span class="nav-text">ping命令诊断网络故障</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pathping命令跟踪数据包路径"><span class="nav-number">2.</span> <span class="nav-text">pathping命令跟踪数据包路径</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#因特网的路由选择协议"><span class="nav-number">3.</span> <span class="nav-text">因特网的路由选择协议</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#有关路由选择协议的几个基本概念"><span class="nav-number">3.1.</span> <span class="nav-text">有关路由选择协议的几个基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#关于“最佳路由”"><span class="nav-number">3.1.1.</span> <span class="nav-text">关于“最佳路由”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从路由算法的自适应性考虑"><span class="nav-number">3.1.2.</span> <span class="nav-text">从路由算法的自适应性考虑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分层次的路由选择协议"><span class="nav-number">3.1.3.</span> <span class="nav-text">分层次的路由选择协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自治系统-AS-Autonomous-System"><span class="nav-number">3.1.4.</span> <span class="nav-text">自治系统 AS(Autonomous System)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#因特网有两大类路由选择协议"><span class="nav-number">3.1.5.</span> <span class="nav-text">因特网有两大类路由选择协议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内部网关协议-RIP-Routing-Information-Protocol"><span class="nav-number">3.2.</span> <span class="nav-text">内部网关协议 RIP(Routing Information Protocol)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#特点"><span class="nav-number">3.2.1.</span> <span class="nav-text">特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#“距离”的定义"><span class="nav-number">3.2.2.</span> <span class="nav-text">“距离”的定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简化过程举例"><span class="nav-number">3.2.3.</span> <span class="nav-text">简化过程举例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为什么需要周期性广播？"><span class="nav-number">3.2.4.</span> <span class="nav-text">为什么需要周期性广播？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内部网关协议OSPF-Open-Shortest-Path-First"><span class="nav-number">3.3.</span> <span class="nav-text">内部网关协议OSPF (Open Shortest Path First)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OSPF-协议的基本特点"><span class="nav-number">3.3.1.</span> <span class="nav-text">OSPF 协议的基本特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三个要点"><span class="nav-number">3.3.2.</span> <span class="nav-text">三个要点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#链路状态数据库-link-state-database"><span class="nav-number">3.3.3.</span> <span class="nav-text">链路状态数据库(link-state database)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OSPF-的区域-area"><span class="nav-number">3.3.4.</span> <span class="nav-text">OSPF 的区域(area)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OSPF-的特点"><span class="nav-number">3.3.5.</span> <span class="nav-text">OSPF 的特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OSPF的基本操作流程"><span class="nav-number">3.3.6.</span> <span class="nav-text">OSPF的基本操作流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OSPF-分组"><span class="nav-number">3.3.7.</span> <span class="nav-text">OSPF 分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OSPF-的其他特点"><span class="nav-number">3.3.8.</span> <span class="nav-text">OSPF 的其他特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指定的路由器-designated-router"><span class="nav-number">3.3.9.</span> <span class="nav-text">指定的路由器(designated router)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#与RIP协议的区别"><span class="nav-number">3.3.10.</span> <span class="nav-text">与RIP协议的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#外部网关协议-BGP"><span class="nav-number">3.4.</span> <span class="nav-text">外部网关协议 BGP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#BGP-发言人和自治系统-AS-的关系"><span class="nav-number">3.4.1.</span> <span class="nav-text">BGP 发言人和自治系统 AS 的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AS-的连通图举例"><span class="nav-number">3.4.2.</span> <span class="nav-text">AS 的连通图举例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BGP-发言人交换路径向量"><span class="nav-number">3.4.3.</span> <span class="nav-text">BGP 发言人交换路径向量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BGP-协议的特点"><span class="nav-number">3.4.4.</span> <span class="nav-text">BGP 协议的特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BGP-4-共使用四种报文"><span class="nav-number">3.4.5.</span> <span class="nav-text">BGP-4 共使用四种报文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BGP-报文具有通用的首部"><span class="nav-number">3.4.6.</span> <span class="nav-text">BGP 报文具有通用的首部</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由器在网际互连中的作用"><span class="nav-number">3.5.</span> <span class="nav-text">路由器在网际互连中的作用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#路由器的结构"><span class="nav-number">3.5.1.</span> <span class="nav-text">路由器的结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#典型的路由器的结构"><span class="nav-number">3.5.2.</span> <span class="nav-text">典型的路由器的结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由器中的交换结构分类"><span class="nav-number">3.5.3.</span> <span class="nav-text">路由器中的交换结构分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#“转发”和“路由选择”的区别"><span class="nav-number">3.5.4.</span> <span class="nav-text">“转发”和“路由选择”的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由器输入和输出端口对收到分组的处理"><span class="nav-number">3.5.5.</span> <span class="nav-text">路由器输入和输出端口对收到分组的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分组丢弃"><span class="nav-number">3.5.6.</span> <span class="nav-text">分组丢弃</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fubuking"
      src="/images/black.jpg">
  <p class="site-author-name" itemprop="name">fubuking</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">72</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/fubuk1ng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;fubuk1ng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:904131218@qq.com" title="E-Mail → mailto:904131218@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>








    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fubuking</span>
</div>
  <div class="powered-by">
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Ivli9y7rdKWvTfdYoIKGT98s-MdYXbMMI',
      appKey     : 'dGjPi00gVXfETJxqLbYROVsf',
      placeholder: "(○ °△ °)っ来啊，快活啊！",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>


</body>
</html>
